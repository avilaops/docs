<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>avx-lock - Avx Documentation</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">
                <a href="../index.html" style="color: white; text-decoration: none; display: flex; align-items: center; gap: 0.5rem;">
                    <span>‚ö°</span>
                    <span>Avx Distributed Systems</span>
                </a>
            </div>
            <div class="nav-controls">
                <button class="theme-toggle" onclick="toggleTheme()">‚òÄÔ∏è Modo Claro</button>
                <div class="language-selector">
                    <button class="language-btn" onclick="toggleLanguageDropdown()">üåç Idioma</button>
                    <div class="language-dropdown"></div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div style="margin-bottom: 2rem;">
            <a href="../index.html" style="color: var(--primary-orange);">‚Üê Voltar</a>
        </div>

        <!-- Module Header -->
        <section class="section">
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                <span style="font-size: 3rem;">üîí</span>
                <h1 class="section-title">avx-lock</h1>
            </div>
            <p style="font-size: 1.2rem; opacity: 0.8;">
                Locks distribu√≠dos para exclus√£o m√∫tua entre processos em diferentes m√°quinas.
            </p>
        </section>

        <!-- Overview -->
        <section class="section">
            <h2 class="section-title">Vis√£o Geral</h2>
            <div class="code-block">
                <p><strong>avx-lock</strong> implementa primitivas de sincroniza√ß√£o distribu√≠da:</p>
                <ul>
                    <li>üîí <strong>Distributed Mutex</strong> - Exclus√£o m√∫tua entre n√≥s</li>
                    <li>üìñ <strong>Read-Write Lock</strong> - M√∫ltiplos leitores, um escritor</li>
                    <li>üé´ <strong>Semaphore</strong> - Controle de acesso com contadores</li>
                    <li>‚è±Ô∏è <strong>Timeouts</strong> - Aquisi√ß√£o com limite de tempo</li>
                    <li>üîÑ <strong>Reentrant Locks</strong> - Locks reentr√°veis por thread</li>
                    <li>üö´ <strong>Deadlock Detection</strong> - Detec√ß√£o autom√°tica de deadlocks</li>
                    <li>‚ö° <strong>Fair Queuing</strong> - FIFO para evitar starvation</li>
                    <li>üíæ <strong>Persistente</strong> - Sobrevive a crashes</li>
                </ul>
            </div>
        </section>

        <!-- Types -->
        <section class="section">
            <h2 class="section-title">Tipos Dispon√≠veis</h2>
            <table class="api-table">
                <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Descri√ß√£o</th>
                        <th>Uso Principal</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>DistributedMutex</code></td>
                        <td>Lock exclusivo distribu√≠do</td>
                        <td>Exclus√£o m√∫tua</td>
                    </tr>
                    <tr>
                        <td><code>DistributedRwLock</code></td>
                        <td>Lock leitura/escrita distribu√≠do</td>
                        <td>Concorr√™ncia de leitura</td>
                    </tr>
                    <tr>
                        <td><code>DistributedSemaphore</code></td>
                        <td>Sem√°foro distribu√≠do</td>
                        <td>Limite de acesso concorrente</td>
                    </tr>
                    <tr>
                        <td><code>LockGuard</code></td>
                        <td>RAII guard para lock</td>
                        <td>Auto-release ao sair do escopo</td>
                    </tr>
                    <tr>
                        <td><code>LockManager</code></td>
                        <td>Gerenciador central de locks</td>
                        <td>Coordena√ß√£o de locks</td>
                    </tr>
                    <tr>
                        <td><code>LockConfig</code></td>
                        <td>Configura√ß√£o de locks</td>
                        <td>Timeouts e comportamento</td>
                    </tr>
                    <tr>
                        <td><code>DeadlockDetector</code></td>
                        <td>Detector de deadlocks</td>
                        <td>Preven√ß√£o de deadlocks</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Examples -->
        <section class="section">
            <h2 class="section-title">Exemplos de Uso</h2>
            
            <h3 style="color: var(--primary-orange); margin-top: 2rem;">Distributed Mutex B√°sico</h3>
            <div class="code-block">
                <pre><code>use avx_lock::DistributedMutex;

let mutex = DistributedMutex::new("my-resource");

// Adquirir lock
let guard = mutex.lock()?;

// Se√ß√£o cr√≠tica - apenas este processo pode executar
perform_critical_operation();

// Lock √© liberado automaticamente quando guard sai do escopo
drop(guard);</code></pre>
            </div>

            <h3 style="color: var(--primary-orange); margin-top: 2rem;">Lock com Timeout</h3>
            <div class="code-block">
                <pre><code>use avx_lock::DistributedMutex;
use std::time::Duration;

let mutex = DistributedMutex::new("database-write");

// Tentar adquirir por at√© 5 segundos
match mutex.try_lock_timeout(Duration::from_secs(5))? {
    Some(guard) => {
        // Lock adquirido
        write_to_database()?;
    }
    None => {
        // Timeout - lock n√£o foi adquirido
        println!("N√£o foi poss√≠vel adquirir lock");
    }
}</code></pre>
            </div>

            <h3 style="color: var(--primary-orange); margin-top: 2rem;">Read-Write Lock</h3>
            <div class="code-block">
                <pre><code>use avx_lock::DistributedRwLock;

let rwlock = DistributedRwLock::new("shared-data");

// M√∫ltiplos leitores podem adquirir simultaneamente
let read_guard1 = rwlock.read()?;
let read_guard2 = rwlock.read()?; // OK!

let data = read_shared_data();

drop(read_guard1);
drop(read_guard2);

// Escritor tem acesso exclusivo
let write_guard = rwlock.write()?;
modify_shared_data()?;
drop(write_guard);</code></pre>
            </div>

            <h3 style="color: var(--primary-orange); margin-top: 2rem;">Semaphore Distribu√≠do</h3>
            <div class="code-block">
                <pre><code>use avx_lock::DistributedSemaphore;

// Permitir no m√°ximo 5 acessos concorrentes
let semaphore = DistributedSemaphore::new("api-rate-limit", 5);

// Adquirir permiss√£o
let permit = semaphore.acquire()?;

// Executar opera√ß√£o limitada
call_external_api()?;

// Liberar permiss√£o
drop(permit);</code></pre>
            </div>

            <h3 style="color: var(--primary-orange); margin-top: 2rem;">Detec√ß√£o de Deadlock</h3>
            <div class="code-block">
                <pre><code>use avx_lock::{LockManager, DeadlockDetector};

let manager = LockManager::new();
let detector = DeadlockDetector::new();

// Monitorar locks
manager.on_lock_acquired(|lock_id, holder| {
    detector.add_edge(holder, lock_id);
});

// Verificar deadlocks periodicamente
if let Some(cycle) = detector.detect_cycle() {
    println!("Deadlock detectado: {:?}", cycle);
    
    // Abortar uma transa√ß√£o para resolver
    manager.abort_transaction(cycle[0])?;
}</code></pre>
            </div>
        </section>

        <!-- API Reference -->
        <section class="section">
            <h2 class="section-title">Refer√™ncia da API</h2>
            
            <h3 style="color: var(--primary-orange);">DistributedMutex</h3>
            <table class="api-table">
                <thead>
                    <tr>
                        <th>M√©todo</th>
                        <th>Descri√ß√£o</th>
                        <th>Retorno</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>new(name)</code></td>
                        <td>Cria novo mutex distribu√≠do</td>
                        <td><code>DistributedMutex</code></td>
                    </tr>
                    <tr>
                        <td><code>lock()</code></td>
                        <td>Adquire lock (bloqueia)</td>
                        <td><code>Result&lt;LockGuard&gt;</code></td>
                    </tr>
                    <tr>
                        <td><code>try_lock()</code></td>
                        <td>Tenta adquirir (n√£o bloqueia)</td>
                        <td><code>Result&lt;Option&lt;LockGuard&gt;&gt;</code></td>
                    </tr>
                    <tr>
                        <td><code>try_lock_timeout(d)</code></td>
                        <td>Tenta com timeout</td>
                        <td><code>Result&lt;Option&lt;LockGuard&gt;&gt;</code></td>
                    </tr>
                    <tr>
                        <td><code>is_locked()</code></td>
                        <td>Verifica se est√° locked</td>
                        <td><code>bool</code></td>
                    </tr>
                </tbody>
            </table>

            <h3 style="color: var(--primary-orange); margin-top: 2rem;">DistributedRwLock</h3>
            <table class="api-table">
                <thead>
                    <tr>
                        <th>M√©todo</th>
                        <th>Descri√ß√£o</th>
                        <th>Retorno</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>new(name)</code></td>
                        <td>Cria novo RwLock</td>
                        <td><code>DistributedRwLock</code></td>
                    </tr>
                    <tr>
                        <td><code>read()</code></td>
                        <td>Adquire read lock</td>
                        <td><code>Result&lt;ReadGuard&gt;</code></td>
                    </tr>
                    <tr>
                        <td><code>write()</code></td>
                        <td>Adquire write lock</td>
                        <td><code>Result&lt;WriteGuard&gt;</code></td>
                    </tr>
                    <tr>
                        <td><code>try_read()</code></td>
                        <td>Tenta read (n√£o bloqueia)</td>
                        <td><code>Result&lt;Option&lt;ReadGuard&gt;&gt;</code></td>
                    </tr>
                    <tr>
                        <td><code>try_write()</code></td>
                        <td>Tenta write (n√£o bloqueia)</td>
                        <td><code>Result&lt;Option&lt;WriteGuard&gt;&gt;</code></td>
                    </tr>
                </tbody>
            </table>

            <h3 style="color: var(--primary-orange); margin-top: 2rem;">DistributedSemaphore</h3>
            <table class="api-table">
                <thead>
                    <tr>
                        <th>M√©todo</th>
                        <th>Descri√ß√£o</th>
                        <th>Retorno</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>new(name, permits)</code></td>
                        <td>Cria sem√°foro</td>
                        <td><code>DistributedSemaphore</code></td>
                    </tr>
                    <tr>
                        <td><code>acquire()</code></td>
                        <td>Adquire permiss√£o</td>
                        <td><code>Result&lt;Permit&gt;</code></td>
                    </tr>
                    <tr>
                        <td><code>try_acquire()</code></td>
                        <td>Tenta adquirir</td>
                        <td><code>Result&lt;Option&lt;Permit&gt;&gt;</code></td>
                    </tr>
                    <tr>
                        <td><code>available_permits()</code></td>
                        <td>Permiss√µes dispon√≠veis</td>
                        <td><code>usize</code></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Performance -->
        <section class="section">
            <h2 class="section-title">Performance</h2>
            <div class="animation-showcase">
                <div class="animated-element">
                    üîí Locks de Alta Performance
                </div>
                <div style="margin-top: 2rem; text-align: left; max-width: 800px; margin-left: auto; margin-right: auto;">
                    <h3 style="color: var(--primary-orange);">Benchmarks</h3>
                    <table class="api-table">
                        <thead>
                            <tr>
                                <th>Opera√ß√£o</th>
                                <th>Tempo</th>
                                <th>Throughput</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Mutex Lock (uncontended)</td>
                                <td>~10Œºs</td>
                                <td>100K ops/s</td>
                            </tr>
                            <tr>
                                <td>RwLock Read (uncontended)</td>
                                <td>~8Œºs</td>
                                <td>125K ops/s</td>
                            </tr>
                            <tr>
                                <td>RwLock Write</td>
                                <td>~12Œºs</td>
                                <td>83K ops/s</td>
                            </tr>
                            <tr>
                                <td>Semaphore Acquire</td>
                                <td>~7Œºs</td>
                                <td>142K ops/s</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 style="color: var(--primary-orange); margin-top: 2rem;">Otimiza√ß√µes</h3>
                    <ul>
                        <li>‚úÖ Lock-free fast path para uncontended</li>
                        <li>‚úÖ FIFO queuing para fairness</li>
                        <li>‚úÖ Adaptive spinning antes de bloquear</li>
                        <li>‚úÖ Batched lock operations</li>
                        <li>‚úÖ Zero-copy lock metadata</li>
                    </ul>

                    <h3 style="color: var(--primary-orange); margin-top: 2rem;">Garantias</h3>
                    <ul>
                        <li>‚úÖ Mutual exclusion garantida</li>
                        <li>‚úÖ Deadlock-free com timeouts</li>
                        <li>‚úÖ Fair queuing (FIFO)</li>
                        <li>‚úÖ Crash recovery autom√°tico</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Use Cases -->
        <section class="section">
            <h2 class="section-title">Casos de Uso</h2>
            
            <div class="module-card animated-element">
                <h3 class="module-title">üíæ Sincroniza√ß√£o de Banco de Dados</h3>
                <p>Proteja escritas concorrentes em banco de dados distribu√≠do.</p>
                <div class="code-block">
                    <pre><code>let mutex = DistributedMutex::new("user-update");

// Apenas um n√≥ pode atualizar por vez
let guard = mutex.lock()?;

// Atualizar usu√°rio com seguran√ßa
db.update("users", user_id, new_data)?;

// Lock liberado automaticamente
drop(guard);</code></pre>
                </div>
            </div>

            <div class="module-card animated-element" style="margin-top: 2rem;">
                <h3 class="module-title">üìÑ Cache Distribu√≠do</h3>
                <p>Use RwLock para permitir leituras concorrentes e escritas exclusivas.</p>
                <div class="code-block">
                    <pre><code>let rwlock = DistributedRwLock::new("cache");

// M√∫ltiplos readers
let read_guard = rwlock.read()?;
let data = cache.get(key)?;
drop(read_guard);

// Writer exclusivo
let write_guard = rwlock.write()?;
cache.set(key, new_value)?;
drop(write_guard);</code></pre>
                </div>
            </div>

            <div class="module-card animated-element" style="margin-top: 2rem;">
                <h3 class="module-title">‚ö° Rate Limiting Distribu√≠do</h3>
                <p>Use sem√°foro para limitar acessos concorrentes globalmente.</p>
                <div class="code-block">
                    <pre><code>// M√°ximo 100 requests simult√¢neas no cluster
let semaphore = DistributedSemaphore::new("api-limit", 100);

// Adquirir permiss√£o
let permit = semaphore.acquire()?;

// Executar request
handle_api_request()?;

// Permiss√£o liberada automaticamente
drop(permit);</code></pre>
                </div>
            </div>
        </section>

        <!-- License -->
        <section class="section">
            <h2 class="section-title">Licen√ßa</h2>
            <div class="code-block">
                <p><strong>Copyright ¬© 2025 N√≠colas √Åvila - Todos os Direitos Reservados</strong></p>
                <p>Este m√≥dulo faz parte do ecossistema propriet√°rio Avx.</p>
                <p>Para uso comercial, entre em contato:</p>
                <ul>
                    <li>üìß Email: nicolas@avila.inc</li>
                    <li>üåê Website: https://avila.inc</li>
                </ul>
            </div>
        </section>
    </div>

    <footer>
        <p>Copyright ¬© 2025 N√≠colas √Åvila - Todos os Direitos Reservados</p>
        <p>avx-lock - Software Propriet√°rio</p>
    </footer>

    <script src="../assets/js/main.js"></script>
</body>
</html>