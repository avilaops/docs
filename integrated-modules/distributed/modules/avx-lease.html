<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>avx-lease - Avx Documentation</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">
                <a href="../index.html" style="color: white; text-decoration: none; display: flex; align-items: center; gap: 0.5rem;">
                    <span>‚ö°</span>
                    <span>Avx Distributed Systems</span>
                </a>
            </div>
            <div class="nav-controls">
                <button class="theme-toggle" onclick="toggleTheme()">‚òÄÔ∏è Modo Claro</button>
                <div class="language-selector">
                    <button class="language-btn" onclick="toggleLanguageDropdown()">üåç Idioma</button>
                    <div class="language-dropdown"></div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div style="margin-bottom: 2rem;">
            <a href="../index.html" style="color: var(--primary-orange);">‚Üê Voltar</a>
        </div>

        <!-- Module Header -->
        <section class="section">
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                <span style="font-size: 3rem;">‚è∞</span>
                <h1 class="section-title">avx-lease</h1>
            </div>
            <p style="font-size: 1.2rem; opacity: 0.8;">
                Gerenciamento de leases tempor√°rios para coordena√ß√£o distribu√≠da com tempo limitado.
            </p>
        </section>

        <!-- Overview -->
        <section class="section">
            <h2 class="section-title">Vis√£o Geral</h2>
            <div class="code-block">
                <p><strong>avx-lease</strong> implementa sistema de leases com expira√ß√£o autom√°tica:</p>
                <ul>
                    <li>‚è∞ <strong>Time-Based Leases</strong> - Concess√µes com tempo de expira√ß√£o</li>
                    <li>üîÑ <strong>Renewal Autom√°tico</strong> - Renova√ß√£o peri√≥dica de leases ativos</li>
                    <li>‚ö° <strong>Revoga√ß√£o Imediata</strong> - Cancelamento instant√¢neo de leases</li>
                    <li>üîí <strong>Exclus√£o M√∫tua</strong> - Apenas um holder por lease</li>
                    <li>üìä <strong>Lease Monitoring</strong> - Rastreamento de leases ativos</li>
                    <li>üéØ <strong>Fencing Tokens</strong> - Prote√ß√£o contra m√∫ltiplos holders</li>
                    <li>üíæ <strong>Persist√™ncia</strong> - Leases sobrevivem a restarts</li>
                    <li>üöÄ <strong>Alta Performance</strong> - Aquisi√ß√£o em microssegundos</li>
                </ul>
            </div>
        </section>

        <!-- Types -->
        <section class="section">
            <h2 class="section-title">Tipos Dispon√≠veis</h2>
            <table class="api-table">
                <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Descri√ß√£o</th>
                        <th>Uso Principal</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>LeaseManager</code></td>
                        <td>Gerenciador de leases</td>
                        <td>Controle centralizado</td>
                    </tr>
                    <tr>
                        <td><code>Lease</code></td>
                        <td>Representa√ß√£o de um lease</td>
                        <td>Concess√£o ativa</td>
                    </tr>
                    <tr>
                        <td><code>LeaseId</code></td>
                        <td>Identificador √∫nico de lease</td>
                        <td>Refer√™ncia a leases</td>
                    </tr>
                    <tr>
                        <td><code>LeaseHolder</code></td>
                        <td>Cliente que possui o lease</td>
                        <td>Ownership tracking</td>
                    </tr>
                    <tr>
                        <td><code>FencingToken</code></td>
                        <td>Token monot√¥nico crescente</td>
                        <td>Prote√ß√£o contra split-brain</td>
                    </tr>
                    <tr>
                        <td><code>LeaseConfig</code></td>
                        <td>Configura√ß√£o de leases</td>
                        <td>Par√¢metros de TTL e renewal</td>
                    </tr>
                    <tr>
                        <td><code>LeaseMetrics</code></td>
                        <td>M√©tricas de uso</td>
                        <td>Observabilidade</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Examples -->
        <section class="section">
            <h2 class="section-title">Exemplos de Uso</h2>
            
            <h3 style="color: var(--primary-orange); margin-top: 2rem;">Adquirir Lease</h3>
            <div class="code-block">
                <pre><code>use avx_lease::{LeaseManager, Duration};

let manager = LeaseManager::new();

// Adquirir lease por 30 segundos
let lease = manager.acquire(
    "database-master",
    "node-1",
    Duration::from_secs(30)
)?;

println!("Lease adquirido: {:?}", lease.id());
println!("Fencing token: {}", lease.fencing_token());

// Trabalhar com o recurso...

// Liberar lease
manager.release(lease.id())?;</code></pre>
            </div>

            <h3 style="color: var(--primary-orange); margin-top: 2rem;">Renova√ß√£o Autom√°tica</h3>
            <div class="code-block">
                <pre><code>use avx_lease::{LeaseManager, LeaseConfig};

let config = LeaseConfig {
    ttl: Duration::from_secs(30),
    renewal_interval: Duration::from_secs(10),
    auto_renew: true,
};

let manager = LeaseManager::with_config(config);
let lease = manager.acquire("resource", "client-1", config.ttl)?;

// Lease ser√° renovado automaticamente a cada 10 segundos
// Enquanto o cliente estiver ativo</code></pre>
            </div>

            <h3 style="color: var(--primary-orange); margin-top: 2rem;">Verificar Lease Ativo</h3>
            <div class="code-block">
                <pre><code>use avx_lease::LeaseManager;

let manager = LeaseManager::new();

// Tentar adquirir lease j√° ocupado
match manager.try_acquire("resource", "client-2", Duration::from_secs(30)) {
    Ok(lease) => {
        println!("Lease adquirido!");
    }
    Err(e) if e.is_already_held() => {
        println!("Lease j√° est√° sendo usado");
        
        // Obter holder atual
        let holder = manager.get_holder("resource")?;
        println!("Holder: {}", holder);
    }
    Err(e) => return Err(e),
}</code></pre>
            </div>

            <h3 style="color: var(--primary-orange); margin-top: 2rem;">Fencing Tokens</h3>
            <div class="code-block">
                <pre><code>use avx_lease::{LeaseManager, FencingToken};

let manager = LeaseManager::new();
let lease1 = manager.acquire("resource", "client-1", Duration::from_secs(30))?;

let token1 = lease1.fencing_token();

// Lease expira e outro cliente adquire
std::thread::sleep(Duration::from_secs(31));

let lease2 = manager.acquire("resource", "client-2", Duration::from_secs(30))?;
let token2 = lease2.fencing_token();

// token2 > token1 (monotonicamente crescente)
assert!(token2 > token1);

// Use token para proteger opera√ß√µes
if current_token >= token1 {
    // Seguro executar opera√ß√£o
}</code></pre>
            </div>

            <h3 style="color: var(--primary-orange); margin-top: 2rem;">Revogar Lease</h3>
            <div class="code-block">
                <pre><code>use avx_lease::LeaseManager;

let manager = LeaseManager::new();
let lease = manager.acquire("resource", "client-1", Duration::from_secs(60))?;

// Administrador revoga o lease
manager.revoke(lease.id())?;

// Cliente detecta revoga√ß√£o
if !manager.is_valid(lease.id()) {
    println!("Lease foi revogado!");
    // Parar opera√ß√µes imediatamente
}</code></pre>
            </div>
        </section>

        <!-- API Reference -->
        <section class="section">
            <h2 class="section-title">Refer√™ncia da API</h2>
            
            <h3 style="color: var(--primary-orange);">LeaseManager</h3>
            <table class="api-table">
                <thead>
                    <tr>
                        <th>M√©todo</th>
                        <th>Descri√ß√£o</th>
                        <th>Retorno</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>new()</code></td>
                        <td>Cria manager com config padr√£o</td>
                        <td><code>LeaseManager</code></td>
                    </tr>
                    <tr>
                        <td><code>acquire(name, holder, ttl)</code></td>
                        <td>Adquire novo lease</td>
                        <td><code>Result&lt;Lease&gt;</code></td>
                    </tr>
                    <tr>
                        <td><code>try_acquire(name, holder, ttl)</code></td>
                        <td>Tenta adquirir (n√£o bloqueia)</td>
                        <td><code>Result&lt;Lease&gt;</code></td>
                    </tr>
                    <tr>
                        <td><code>renew(id)</code></td>
                        <td>Renova lease existente</td>
                        <td><code>Result&lt;()&gt;</code></td>
                    </tr>
                    <tr>
                        <td><code>release(id)</code></td>
                        <td>Libera lease</td>
                        <td><code>Result&lt;()&gt;</code></td>
                    </tr>
                    <tr>
                        <td><code>revoke(id)</code></td>
                        <td>Revoga lease for√ßadamente</td>
                        <td><code>Result&lt;()&gt;</code></td>
                    </tr>
                    <tr>
                        <td><code>is_valid(id)</code></td>
                        <td>Verifica se lease √© v√°lido</td>
                        <td><code>bool</code></td>
                    </tr>
                    <tr>
                        <td><code>get_holder(name)</code></td>
                        <td>Obt√©m holder atual</td>
                        <td><code>Option&lt;String&gt;</code></td>
                    </tr>
                </tbody>
            </table>

            <h3 style="color: var(--primary-orange); margin-top: 2rem;">Lease</h3>
            <table class="api-table">
                <thead>
                    <tr>
                        <th>M√©todo</th>
                        <th>Descri√ß√£o</th>
                        <th>Retorno</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>id()</code></td>
                        <td>Obt√©m ID do lease</td>
                        <td><code>LeaseId</code></td>
                    </tr>
                    <tr>
                        <td><code>fencing_token()</code></td>
                        <td>Obt√©m fencing token</td>
                        <td><code>FencingToken</code></td>
                    </tr>
                    <tr>
                        <td><code>expires_at()</code></td>
                        <td>Timestamp de expira√ß√£o</td>
                        <td><code>Instant</code></td>
                    </tr>
                    <tr>
                        <td><code>time_remaining()</code></td>
                        <td>Tempo at√© expirar</td>
                        <td><code>Duration</code></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Performance -->
        <section class="section">
            <h2 class="section-title">Performance</h2>
            <div class="animation-showcase">
                <div class="animated-element">
                    ‚è∞ Leases Ultra-R√°pidos
                </div>
                <div style="margin-top: 2rem; text-align: left; max-width: 800px; margin-left: auto; margin-right: auto;">
                    <h3 style="color: var(--primary-orange);">Benchmarks</h3>
                    <table class="api-table">
                        <thead>
                            <tr>
                                <th>Opera√ß√£o</th>
                                <th>Tempo</th>
                                <th>Throughput</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Acquire Lease</td>
                                <td>~5Œºs</td>
                                <td>200K ops/s</td>
                            </tr>
                            <tr>
                                <td>Renew Lease</td>
                                <td>~2Œºs</td>
                                <td>500K ops/s</td>
                            </tr>
                            <tr>
                                <td>Release Lease</td>
                                <td>~3Œºs</td>
                                <td>333K ops/s</td>
                            </tr>
                            <tr>
                                <td>Validity Check</td>
                                <td>~100ns</td>
                                <td>10M ops/s</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 style="color: var(--primary-orange); margin-top: 2rem;">Otimiza√ß√µes</h3>
                    <ul>
                        <li>‚úÖ Lock-free lease tracking</li>
                        <li>‚úÖ Zero-allocation validity checks</li>
                        <li>‚úÖ Efficient expiration scanning</li>
                        <li>‚úÖ Batched renewals</li>
                        <li>‚úÖ Memory-mapped persistence</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Use Cases -->
        <section class="section">
            <h2 class="section-title">Casos de Uso</h2>
            
            <div class="module-card animated-element">
                <h3 class="module-title">üóÑÔ∏è Elei√ß√£o de Master</h3>
                <p>Use leases para garantir apenas um master ativo por vez.</p>
                <div class="code-block">
                    <pre><code>let manager = LeaseManager::new();

// Tentar se tornar master
match manager.try_acquire("db-master", node_id, Duration::from_secs(30)) {
    Ok(lease) => {
        println!("Sou o master!");
        
        // Renovar periodicamente enquanto master
        loop {
            manager.renew(lease.id())?;
            tokio::time::sleep(Duration::from_secs(10)).await;
        }
    }
    Err(_) => {
        println!("Outro n√≥ √© master");
    }
}</code></pre>
                </div>
            </div>

            <div class="module-card animated-element" style="margin-top: 2rem;">
                <h3 class="module-title">üîê Acesso Exclusivo a Recurso</h3>
                <p>Garanta que apenas um worker processe um recurso por vez.</p>
                <div class="code-block">
                    <pre><code>// Worker tenta adquirir lease para processar
let lease = manager.acquire(
    &format!("job-{}", job_id),
    worker_id,
    Duration::from_secs(300)
)?;

// Processar job com exclusividade
process_job(job_id)?;

// Liberar quando terminar
manager.release(lease.id())?;</code></pre>
                </div>
            </div>

            <div class="module-card animated-element" style="margin-top: 2rem;">
                <h3 class="module-title">‚öôÔ∏è Cache Distribu√≠do</h3>
                <p>Use leases para gerenciar ownership de cache entries.</p>
                <div class="code-block">
                    <pre><code>// N√≥ adquire lease para fazer cache
let lease = manager.acquire(
    &format!("cache-{}", key),
    node_id,
    Duration::from_secs(60)
)?;

// Carregar dados e fazer cache
let data = load_data(key)?;
cache.set(key, data);

// Renovar enquanto dados est√£o quentes
// Expirar automaticamente se n√£o renovado</code></pre>
                </div>
            </div>
        </section>

        <!-- License -->
        <section class="section">
            <h2 class="section-title">Licen√ßa</h2>
            <div class="code-block">
                <p><strong>Copyright ¬© 2025 N√≠colas √Åvila - Todos os Direitos Reservados</strong></p>
                <p>Este m√≥dulo faz parte do ecossistema propriet√°rio Avx.</p>
                <p>Para uso comercial, entre em contato:</p>
                <ul>
                    <li>üìß Email: nicolas@avila.inc</li>
                    <li>üåê Website: https://avila.inc</li>
                </ul>
            </div>
        </section>
    </div>

    <footer>
        <p>Copyright ¬© 2025 N√≠colas √Åvila - Todos os Direitos Reservados</p>
        <p>avx-lease - Software Propriet√°rio</p>
    </footer>

    <script src="../assets/js/main.js"></script>
</body>
</html>